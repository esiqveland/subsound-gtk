id: com.github.Subsound
runtime: org.gnome.Platform
runtime-version: '47'
sdk: org.gnome.Sdk
add-extensions:
  - "org.freedesktop.Sdk.Extension.openjdk"
sdk-extensions:
  - "org.freedesktop.Sdk.Extension.openjdk"
build-options:
  append-path: "/usr/lib/sdk/openjdk/bin"
command: hello
finish-args:
  - "--env=PATH=/app/jre/bin:/usr/bin"
  - "--socket=pulseaudio"
  - "--socket=wayland"
  - "--socket=fallback-x11"
  - "--share=ipc"
  - "--share=network"
  # Direct Rendering Interface. Necessary for GL. # TODO: Is this needed for accelerated GTK rendering?
  - "--device=dri"
  - "--filesystem=xdg-config:create"
  - "--filesystem=xdg-cache:create"
  - "--filesystem=xdg-data:create"
  - "--env=JAVA_HOME=/app/jre"
  #- "--talk-name=org.freedesktop.FileManager1",
  #- "--filesystem=home:rw"
modules:
  - name: openjdk
    buildsystem: 'simple'
    only-arches:
      - x86_64
    build-commands:
      - "/usr/lib/sdk/openjdk/install.sh"
  - name: hello
    buildsystem: simple
    build-commands:
      # We make the Gradle wrapper use our local .zip file
      # NOTA: mind the fact that expand() will reduce the backslashes in template, so double them!
      - ln --force gradle-8.9-all.zip gradle/wrapper/gradle-8.9-all.zip
      - ls -la offline-repository
      - >-
        sed --regexp-extended --in-place
        's,https\\://services.gradle.org/distributions/,file:\/run/build/hello/,'
        gradle/wrapper/gradle-wrapper.properties
      - bash gradlew --offline build
      - install -Dm755 hello.sh /app/bin/hello
    only-arches:
      - x86_64
    sources:
      - type: git
        url: https://github.com/esiqveland/subsound-gtk
        tag: v0.1.0-alpha1
      - type: file
        url: https://services.gradle.org/distributions/gradle-8.9-all.zip
        sha256: 258e722ec21e955201e31447b0aed14201765a3bfbae296a46cf60b70e66db70
      # Include app flatpak-sources.json, generated by Gradle task flatpakGradleGenerator
      - 'flatpak-sources.json'
      - type: script
        dest-filename: hello.sh
        commands:
          - echo "Hello world, from a sandbox"






